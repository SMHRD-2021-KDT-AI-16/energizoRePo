<!DOCTYPE html>
<html>
<head>
  <title>chatGPT API</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <style>
    /* page-loading */
    #loading {
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      position: fixed;
      display: block;
      opacity: 0.6;
      background: #e4e4e4;
      z-index: 99;
      text-align: center;
    }

    #loading>img {
      position: absolute;
      top: 40%;
      left: 45%;
      z-index: 100;
    }

    #loading>p {
      position: absolute;
      top: 57%;
      left: 43%;
      z-index: 101;
    }
  </style>
</head>

<body>
  <h1>chatGPT API</h1>
  <div>무엇이든 질문해보세요 !!</div>

  <input type="text" id="keywords" name="keywords" required />
  <div id = "keybox_purpose">
        <span class="key_title">목적</span>
        <span class="keyword_purpose">체중감소<input type="checkbox" name="checkbox" value="diet" class="checkbox"></span>
        <span class="keyword_purpose">체중증가<input type="checkbox" name="checkbox" value="bulk" class="checkbox"></span>
        <span class="keyword_purpose">비조리요리<input type="checkbox" name="checkbox" value="nocook" class="checkbox"></span>
        <span class="keyword_purpose">저당식<input type="checkbox" name="checkbox" value="lowsugar" class="checkbox"></span>
        <span class="keyword_purpose">저염식<input type="checkbox" name="checkbox" value="lowsalt" class="checkbox"></span>
    </div>
    <div id = "keybox_ingre1">
        <span class="key_title">피해야할 식재료1</span>
        <span class="keyword_ingre1">카페인<input type="checkbox" name="checkbox" value="caffeine" class="checkbox"></span>
        <span class="keyword_ingre1">샐러리<input type="checkbox" name="checkbox" value="celery" class="checkbox"></span>
        <span class="keyword_ingre1">갑각류<input type="checkbox" name="checkbox" value="crustaceans" class="checkbox"></span>
        <span class="keyword_ingre1">달걀<input type="checkbox" name="checkbox" value="egg" class="checkbox"></span>
        <span class="keyword_ingre1">생선<input type="checkbox" name="checkbox" value="fish" class="checkbox"></span>
        <span class="keyword_ingre1">글루텐<input type="checkbox" name="checkbox" value="gluten" class="checkbox"></span>
        <span class="keyword_ingre1">땅콩<input type="checkbox" name="checkbox" value="peanut" class="checkbox"></span>
        <span class="keyword_ingre1">우유<input type="checkbox" name="checkbox" value="milk" class="checkbox"></span>
    </div>
     <div id = "keybox_ingre2">
        <span class="key_title">피해야할 식재료2</span>
        <span class="keyword_ingre2">연체동물<input type="checkbox" name="checkbox" value="mollusc" class="checkbox"></span>
        <span class="keyword_ingre2">겨자<input type="checkbox" name="checkbox" value="mustard" class="checkbox"></span>
        <span class="keyword_ingre2">참깨<input type="checkbox" name="checkbox" value="sesame" class="checkbox"></span>
        <span class="keyword_ingre2">대두<input type="checkbox" name="checkbox" value="bean" class="checkbox"></span>
        <span class="keyword_ingre2">견과<input type="checkbox" name="checkbox" value="nuts" class="checkbox"></span>
        <span class="keyword_ingre2">밀<input type="checkbox" name="checkbox" value="wheat" class="checkbox"></span>
        <span class="keyword_ingre2">젖당<input type="checkbox" name="checkbox" value="lactose" class="checkbox"></span>
        <span class="keyword_ingre2">이스트<input type="checkbox" name="checkbox" value="yeast" class="checkbox"></span>
    </div>
    <div id = "keybox_style">
        <span class="key_title">식단 스타일</span>
        <span class="keyword_style">채식주의<input type="checkbox" name="checkbox" value="vegetarian" class="checkbox"></span>
        <span class="keyword_style">비건식<input type="checkbox" name="checkbox" value="vegan" class="checkbox"></span>
        <span class="keyword_style">키토제닉<input type="checkbox" name="checkbox" value="chito" class="checkbox"></span>
        <span class="keyword_style">유제품 미포함<input type="checkbox" name="checkbox" value="nomilk" class="checkbox"></span>
        <span class="keyword_style">저탄수화물<input type="checkbox" name="checkbox" value="lowcarbo" class="checkbox"></span>
        <span class="keyword_style">글루텐 프리<input type="checkbox" name="checkbox" value="glufree" class="checkbox"></span>
    </div>
   <input id="btn_click" onclick="chatGPT()" value="추천받기" type="submit">
</form>
<span>
   <div id="result"></div>
       
   <div id="loading">
   <img src="https://studentrights.sen.go.kr/images/common/loading.gif">
   </div>
   
   
   <script>
       $(document).ready(function () {
           $('#loading').hide();
       });
   
       function chatGPT() {
    	   const purposeValues = [];
    	   const ingre1Values = [];
    	   const ingre2Values = [];
    	   const styleValues = [];
    	   
           const api_key = "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"  // <- API KEY 입력
           
           const checkboxes1 = document.querySelectorAll('.keyword_purpose input[type="checkbox"]');
           const checkboxes2 = document.querySelectorAll('.keyword_ingre1 input[type="checkbox"]');
           const checkboxes3 = document.querySelectorAll('.keyword_ingre2 input[type="checkbox"]');
           const checkboxes4 = document.querySelectorAll('.keyword_style input[type="checkbox"]');
           
           checkboxes1.forEach(function (checkbox1) {
               if (checkbox1.checked) {
            	   purposeValues.push(checkbox1.value);
               }
           });
           checkboxes2.forEach(function (checkbox2) {
               if (checkbox2.checked) {
            	   ingre1Values.push(checkbox2.value);
               }
           });
           checkboxes3.forEach(function (checkbox3) {
               if (checkbox3.checked) {
            	   ingre2Values.push(checkbox3.value);
               }
           });
           checkboxes4.forEach(function (checkbox4) {
               if (checkbox4.checked) {
            	   styleValues.push(checkbox.value);
               }
           });
           
           const purposeString = purposeValues.join(', '); // 목적 배열을 문자열로 변환
           const ingre1String = ingre1Values.join(', '); // 식재료1 배열을 문자열로 변환
           const ingre2String = ingre2Values.join(', '); // 식재료2 배열을 문자열로 변환
           const styleString = styleValues.join(', '); // 식단 스타일 배열을 문자열로 변환
           
           $('#loading').show();
           
           const messages = [
               { role: 'system', content: 'You are a helpful assistant.' },
               { role: 'user', content: '나의 목적은 '+purposeString+'이고 피해야 할 식재료는'+ ingre1String+ ',' + ingre2String+'이고 나의 식사 스타일은 '+ styleString+ ' 스타일이야.' + '기본 : 아침,점심,저녁메뉴, 각메뉴는 하나씩만 알려줘. 구성방식은 1.음식명: [내용 ] 2.식재료: [내용] 3.조리법 : [내용] 식재료는 1인기준 정량으로 레시피는 자세히 알려주고 모든 줄마다 번호를 적어줘. 조건 : (문단뒤에 조건 : +내용). 이것을 토대로 추천해줘.'},
           ]
   
           const data = {
               model: 'gpt-3.5-turbo',
               temperature: 0.5,
               n: 1,
               messages: messages,
           }
   
           $.ajax({
               url: "https://api.openai.com/v1/chat/completions",
               method: 'POST',
               headers: {
                   Authorization: "Bearer " + api_key,
                   'Content-Type': 'application/json',
               },
               data: JSON.stringify(data),
           }).then(function (response) {
               $('#loading').hide();
               console.log(response)
               let result = document.getElementById('result')
   
               // 이전 결과를 지우고 새로운 결과를 추가
               result.innerHTML = ''; // 결과를 지움
   
               let pre = document.createElement('pre')
               pre.innerHTML = "\n\n" + response.choices[0].message.content
               result.appendChild(pre)
   
               document.getElementById('keywords').value = ''
               
           });
       console.log(message)
       }
       console.log(message)
   </script>
</span>
</body>
</html>